@using WirtualnaUczelnia.Extensions
@model WirtualnaUczelnia.Models.Location

@{
    ViewData["Title"] = "Wirtualny Spacer";
}

<style>
    .nav-arrow {
        position: absolute;
        transform: translate(-50%, -50%);
        opacity: 0.9;
        transition: transform 0.2s, opacity 0.2s;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        border: 3px solid white;
        box-shadow: 0 0 15px rgba(0,0,0,0.7);
        z-index: 100;
        background-color: rgba(0,0,0,0.5);
        color: white;
        text-decoration: none;
    }

        .nav-arrow:hover {
            transform: translate(-50%, -50%) scale(1.2);
            opacity: 1;
            background-color: rgba(0,0,0,0.8);
            color: #ffd700;
        }

    .image-container {
        position: relative;
        display: block;
        width: 100%;
        overflow: hidden;
        border-radius: 8px;
        background-color: #eee;
        min-height: 400px;
    }
</style>

<div class="container text-center mt-4">

    <!-- Przycisk powrotu do wyboru budynku -->
    <div class="text-start mb-3">
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
            &larr; Powrót do mapy kampusu
        </a>
    </div>

    <div class="row">
        <div class="col-md-12">

            <div class="card shadow-lg">
                <div class="card-body p-0">

                    <!-- Kontener na zdjęcie i strzałki -->
                    <div class="image-container">

                        <!-- Zdjęcie -->
                        <img src="~/images/@Model.ImageFileName" class="img-fluid w-100" alt="@Model.Name"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/1200x600?text=Brak+pliku:+@Model.ImageFileName';">

                        <!-- Informacja o braku przejść -->
                        @if (Model.Transitions == null || !Model.Transitions.Any())
                        {
                            <div class="alert alert-warning position-absolute top-50 start-50 translate-middle">
                                Brak zdefiniowanych przejść (strzałek) dla tej lokacji.
                                <br>
                                <!-- ZMIANA: Link prowadzi teraz do listy lokacji, gdzie można zarządzać ich zdjęciami i innymi danymi -->
                                <a asp-controller="Locations" asp-action="Index" class="btn btn-sm btn-warning mt-2">Zarządzaj Lokalizacjami</a>
                                <!-- Opcjonalnie możesz dodać drugi link do zarządzania przejściami -->
                                <a asp-controller="Transitions" asp-action="Index" class="btn btn-sm btn-secondary mt-2">Zarządzaj Przejściami</a>
                            </div>
                        }
                        else
                        {
                            <!-- Strzałki Nawigacyjne -->
                            @foreach (var transition in Model.Transitions)
                            {
                                string arrowIcon = "⬆️";
                                string title = "Idź";

                                switch (transition.Direction)
                                {
                                    case WirtualnaUczelnia.Models.Direction.Forward: arrowIcon = "⬆️"; title = "Prosto"; break;
                                    case WirtualnaUczelnia.Models.Direction.Back: arrowIcon = "⬇️"; title = "W tył"; break;
                                    case WirtualnaUczelnia.Models.Direction.Left: arrowIcon = "⬅️"; title = "W lewo"; break;
                                    case WirtualnaUczelnia.Models.Direction.Right: arrowIcon = "➡️"; title = "W prawo"; break;
                                }

                                <!-- Pozycjonowanie -->
                                <a asp-action="Index" asp-route-id="@transition.TargetLocationId"
                                   class="nav-arrow"
                                   style="left: @transition.PositionX%; top: @transition.PositionY%;"
                                   title="@title">
                                    @arrowIcon
                                </a>
                            }
                        }
                    </div>

                </div>
                <div class="card-footer text-start">
                    <h2 class="card-title">@Model.Name</h2>
                    <p class="card-text lead">@Model.Description</p>

                    @if (!string.IsNullOrEmpty(Model.AudioFileName))
                    {
                        <div class="my-2 p-2 bg-light rounded border">
                            <strong>Lektor:</strong>
                            <audio controls class="w-100 mt-1">
                                <source src="~/audio/@Model.AudioFileName" type="audio/mpeg">
                                Twój lektor nie działa (plik: @Model.AudioFileName).
                            </audio>
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>
</div>